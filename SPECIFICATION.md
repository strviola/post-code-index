# 技術資料

## 実行方式

当プログラムでは以下の2種類のキャッシュファイルを使用します。

- post_code.rb (郵便番号インデックス)
- n_gram_dictionary_#{n}.rb (N-gram インデックス)

これらはディレクトリ lib/cache 以下に保存されます。

### 郵便番号インデックス

内容は定数 `POST_CODE_DICTIONARY` が定義された `module` となっています。これは Ruby スクリプトとして読み込むことができ、以下の通り郵便番号とレコードを対応付けています。 (可読性のため一部空白と改行を追加しています)

```post_code.rb
module PostCode
  POST_CODE_DICTIONARY = {
    "0600000" => [
      ["01101", "060  ", "0600000", "ホッカイドウ", "サッポロシチュウオウク", "イカニケイサイガナイバアイ",
      "北海道", "札幌市中央区", "以下に掲載がない場合", "0", "0", "0", "0", "0", "0"]
    ],
    "0640941" => [
      ["01101", "064  ", "0640941", "ホッカイドウ", "サッポロシチュウオウク", "アサヒガオカ",
      "北海道", "札幌市中央区", "旭ケ丘", "0", "0", "1", "0", "0", "0"]
    ],
    "0600041" => [
      ["01101", "060  ", "0600041", "ホッカイドウ", "サッポロシチュウオウク", "オオドオリヒガシ",
      "北海道", "札幌市中央区", "大通東", "0", "0", "1", "0", "0", "0"]
    ],
    # 中略
  }
end
```

なお、1つの郵便番号に対してレコードは複数存在する場合があるため、郵便番号に対応する値はレコードの配列となっています。

### N-gram インデックス

内容は定数 `N_GRAM_DICTIONARY` が定義された `module` となっています。以下に 2-gram インデックスデータの例を示します。

```n_gram_dictionary_2.rb
module NGramDictionary2
  N_GRAM_DICTIONARY = {
    "北海" => ["0600000", "0640941", "0600041", "0600042", "0640820",], # 途中省略
    "海道" => ["0600000", "0640941", "0600041", "0600042", "0640820",], # 途中省略
    # 中略
  }
end
```
